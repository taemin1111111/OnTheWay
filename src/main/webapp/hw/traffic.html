<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ê³ ì†ë„ë¡œ íœ´ê²Œì†Œì™€ ì¹´ì¹´ì˜¤ ì§€ë„</title>
  
  <!-- Kakao Map SDK -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=5ac2ea2e11f7b380cdf52afbcc384b44"></script>

  <!-- Google Fonts & Bootstrap CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Black+And+White+Picture&family=Cute+Font&family=Gamja+Flower&family=Jua&family=Nanum+Brush+Script&family=Nanum+Gothic+Coding&family=Nanum+Myeongjo&family=Noto+Serif+KR:wght@200..900&family=Poor+Story&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

  <style>
    #map {
      width: 600px;
      height: 400px;
      margin-top: 30px;
      margin-left: 180px;
    }
    .container {
      margin-top: 50px;
    }
    table th, table td {
      text-align: center;
    }
  </style>
</head>

<body>

  <!-- Kakao Map -->
  

  <!-- Highways Rest Area Search Section -->
  <div class="container mt-5">
    <h3>ğŸš— ê³ ì†ë„ë¡œ íœ´ê²Œì†Œ</h3>
    <br>
    
    <select id="selectline">
    	
    </select>
    
    <input type="text" placeholder="ê²€ìƒ‰í•  íœ´ê²Œì†Œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”." style="width:300px;">&nbsp;&nbsp;&nbsp;
    <button type="button" class="btn btn-success" id="search">ê²€ìƒ‰</button>
    <br><br>
    
    <div style=" overflow-y: auto; height: 500px;">
      <table class="table table-bordered mt-3">
        <thead class="table-light">
          <tr>
            <th>íœ´ê²Œì†Œ ì´ë¦„</th>
            <th>ë…¸ì„ ëª…</th>
            <th>ìœ„ë„</th>
            <th>ê²½ë„</th>
            <th>íœ´ê²Œì†Œ ì½”ë“œ</th>
          </tr>
        </thead>
        <tbody id="restTableBody">
        </tbody>
      </table>
    </div>
  </div>
  
  <div id="map"></div>

  <script type="text/javascript">
    // Kakao Map ì´ˆê¸°í™”
    window.onload = function() {
      const container = document.getElementById('map');
      const options = {
        center: new kakao.maps.LatLng(37.459939, 127.042514),
        level: 3
      };
      const map = new kakao.maps.Map(container, options);
    };

    // ê³ ì†ë„ë¡œ íœ´ê²Œì†Œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    $(document).ready(function () {
      const apiUrl = "https://data.ex.co.kr/openapi/locationinfo/locationinfoRest?key=8385161068&type=json&numOfRows=99";
      const serviceKey = "8385161068"; 
      let fullDataList = [];

      // API í˜¸ì¶œ
      $.ajax({
        url: apiUrl,
        method: "GET",
        data: {
          serviceKey: serviceKey,
          numOfRows: 99,
          pageNo: 1
        },
        dataType: "json",
        success: function (response) {
          fullDataList = response.list;
          renderTable(fullDataList);
        },
        error: function (xhr, status, error) {
          console.error("API í˜¸ì¶œ ì˜¤ë¥˜:", error);
          alert("íœ´ê²Œì†Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
      });

      // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      $("#search").on("click", function () {
        const keyword = $("input[type='text']").val().trim();
        const keyword2 = $("select").val().trim();
        const filteredList = fullDataList.filter(item =>
          item.unitName.includes(keyword),
          
        );
       
        renderTable(filteredList);
      });
      
      $("#selectline").change(function(){
    	 
    	  const keyword = $("select").val().trim();
    	 
    	  
    	  const filteredList = fullDataList.filter(item =>
          item.routeName.includes(keyword)
          
         
    	  );
    	  renderTable(filteredList);
    	  
    	  
      })
      
      

      // í…Œì´ë¸” ë Œë”ë§ í•¨ìˆ˜
      function renderTable(dataList) {
        let html = "";
        let selectline = "";
        let routeNames = new Set(); // ì¤‘ë³µì„ ì—†ì• ê¸° ìœ„í•´ Set ì‚¬ìš©

        dataList.forEach(item => {
          html += `
            <tr>
              <td>${item.unitName}</td>
              <td>${item.routeName}</td>
              <td>${item.yValue}</td>
              <td>${item.xValue}</td>
              <td>${item.stdRestCd}</td>
            </tr>
          `;
          
          // routeNameì´ ì¤‘ë³µë˜ì§€ ì•Šìœ¼ë©´ ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— ì¶”ê°€
          if (!routeNames.has(item.routeName)) {
            routeNames.add(item.routeName);  // Setì— routeName ì¶”ê°€
            selectline += `
              <option value="${item.routeName}">${item.routeName}</option>
            `;
          }
        });

        $("#restTableBody").html(html);
        $("#selectline").html(selectline);
      }
    });
  </script>

</body>
</html>